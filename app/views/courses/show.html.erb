<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Course Header -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-8">
    <div class="px-6 py-8">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <h1 class="text-3xl font-bold text-gray-900 mb-2"><%= @course.title %></h1>
          <p class="text-gray-600 text-lg mb-4"><%= @course.description %></p>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div>
              <span class="text-sm font-medium text-gray-500">Instructor</span>
              <p class="text-gray-900"><%= @course.instructor %></p>
            </div>
            <div>
              <span class="text-sm font-medium text-gray-500">Platform</span>
              <p class="text-gray-900"><%= @course.platform %></p>
            </div>
            <div>
              <span class="text-sm font-medium text-gray-500">Difficulty</span>
              <p class="text-gray-900 capitalize"><%= @course.difficulty_level %></p>
            </div>
          </div>
          
          <% if @course.url.present? %>
            <a href="<%= @course.url %>" target="_blank" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
              <i class="fas fa-external-link-alt mr-2"></i>
              View Course
            </a>
          <% end %>
        </div>
        
        <div class="ml-6 flex-shrink-0">
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-600"><%= @course.progress_percentage.round %>%</div>
            <div class="text-sm text-gray-500">Complete</div>
          </div>
        </div>
      </div>
      
      <!-- Progress Bar -->
      <div class="mt-6">
        <div class="flex justify-between text-sm text-gray-600 mb-2">
          <span>Progress</span>
          <span><%= @course.completed_items %> of <%= @course.total_items %> items completed</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
          <div class="bg-blue-600 h-2 rounded-full" style="width: <%= @course.progress_percentage %>%"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Course Content Tabs -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200">
    <div class="border-b border-gray-200">
      <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
        <button class="tab-button border-blue-500 text-blue-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="chapters">
          <i class="fas fa-book mr-2"></i>
          Chapters (<%= @course.chapters.count %>)
        </button>
        <button class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="videos">
          <i class="fas fa-play mr-2"></i>
          Videos (<%= @course.videos.count %>)
        </button>
        <button class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="labs">
          <i class="fas fa-flask mr-2"></i>
          Labs (<%= @course.labs.count %>)
        </button>
      </nav>
    </div>
    
    <!-- Chapters Tab -->
    <div id="chapters-tab" class="tab-content p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-medium text-gray-900">Course Chapters</h3>
        <%= link_to new_course_chapter_path(@course), class: "inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" do %>
          <i class="fas fa-plus mr-2"></i>
          Add Chapter
        <% end %>
      </div>
      
      <% if @course.chapters.any? %>
        <div class="space-y-4">
          <% @course.chapters.order(:order_number).each do |chapter| %>
            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
              <div class="flex items-center">
                <% if chapter.completed? %>
                  <i class="fas fa-check-circle text-green-500 mr-3"></i>
                <% else %>
                  <i class="far fa-circle text-gray-400 mr-3"></i>
                <% end %>
                <div>
                  <h3 class="font-medium text-gray-900"><%= chapter.title %></h3>
                  <p class="text-sm text-gray-600"><%= chapter.description %></p>
                  <% if chapter.completed? && chapter.completed_at %>
                    <p class="text-xs text-green-600 mt-1">
                      Completed <%= time_ago_in_words(chapter.completed_at) %> ago
                    </p>
                  <% end %>
                </div>
              </div>
              <div class="flex space-x-2">
                <%= link_to edit_chapter_path(chapter), class: "px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800" do %>
                  <i class="fas fa-edit"></i>
                <% end %>
                <% unless chapter.completed? %>
                  <%= button_to "Mark Complete", complete_chapter_path(chapter), method: :patch, 
                      class: "px-3 py-1 text-xs font-medium text-white bg-green-600 rounded hover:bg-green-700" %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8">
          <p class="text-gray-500 mb-4">No chapters added yet.</p>
          <%= link_to new_course_chapter_path(@course), class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" do %>
            <i class="fas fa-plus mr-2"></i>
            Add Your First Chapter
          <% end %>
        </div>
      <% end %>
    </div>
    
    <!-- Videos Tab -->
    <div id="videos-tab" class="tab-content p-6 hidden">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-medium text-gray-900">Course Videos</h3>
        <%= link_to new_course_video_path(@course), class: "inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" do %>
          <i class="fas fa-plus mr-2"></i>
          Add Video
        <% end %>
      </div>
      
      <% if @course.videos.any? %>
        <div class="space-y-4">
          <% @course.videos.order(:order_number).each do |video| %>
            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
              <div class="flex items-center">
                <% if video.completed? %>
                  <i class="fas fa-check-circle text-green-500 mr-3"></i>
                <% else %>
                  <i class="far fa-play-circle text-gray-400 mr-3"></i>
                <% end %>
                <div>
                  <h3 class="font-medium text-gray-900"><%= video.title %></h3>
                  <p class="text-sm text-gray-600"><%= video.description %></p>
                  <div class="flex items-center space-x-4 mt-1">
                    <span class="text-xs text-gray-500">
                      <%= video.watched_minutes %>/<%= video.duration_minutes %> minutes
                    </span>
                    <% if video.duration_minutes > 0 %>
                      <div class="flex-1 max-w-32">
                        <div class="w-full bg-gray-200 rounded-full h-1">
                          <div class="bg-blue-600 h-1 rounded-full" style="width: <%= (video.watched_minutes.to_f / video.duration_minutes * 100).round %>%"></div>
                        </div>
                      </div>
                    <% end %>
                  </div>
                  <% if video.completed? && video.completed_at %>
                    <p class="text-xs text-green-600 mt-1">
                      Completed <%= time_ago_in_words(video.completed_at) %> ago
                    </p>
                  <% end %>
                </div>
              </div>
              <div class="flex space-x-2">
                <%= link_to edit_video_path(video), class: "px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800" do %>
                  <i class="fas fa-edit"></i>
                <% end %>
                <% unless video.completed? %>
                  <%= button_to "Mark Complete", complete_video_path(video), method: :patch, 
                      class: "px-3 py-1 text-xs font-medium text-white bg-green-600 rounded hover:bg-green-700" %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8">
          <p class="text-gray-500 mb-4">No videos added yet.</p>
          <%= link_to new_course_video_path(@course), class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" do %>
            <i class="fas fa-plus mr-2"></i>
            Add Your First Video
          <% end %>
        </div>
      <% end %>
    </div>
    </div>
    
    <!-- Labs Tab -->
    <div id="labs-tab" class="tab-content p-6 hidden">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-medium text-gray-900">Course Labs</h3>
        <%= link_to new_course_lab_path(@course), class: "inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" do %>
          <i class="fas fa-plus mr-2"></i>
          Add Lab
        <% end %>
      </div>
      
      <% if @course.labs.any? %>
        <div class="space-y-4">
          <% @course.labs.order(:order_number).each do |lab| %>
            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
              <div class="flex items-center">
                <% if lab.completed? %>
                  <i class="fas fa-check-circle text-green-500 mr-3"></i>
                <% else %>
                  <i class="far fa-circle text-gray-400 mr-3"></i>
                <% end %>
                <div>
                  <h3 class="font-medium text-gray-900"><%= lab.title %></h3>
                  <p class="text-sm text-gray-600"><%= lab.description %></p>
                  <% if lab.notes.present? %>
                    <p class="text-xs text-gray-500 mt-1 italic"><%= lab.notes %></p>
                  <% end %>
                  <% if lab.completed? && lab.completed_at %>
                    <p class="text-xs text-green-600 mt-1">
                      Completed <%= time_ago_in_words(lab.completed_at) %> ago
                    </p>
                  <% end %>
                </div>
              </div>
              <div class="flex space-x-2">
                <%= link_to edit_lab_path(lab), class: "px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800" do %>
                  <i class="fas fa-edit"></i>
                <% end %>
                <% unless lab.completed? %>
                  <%= button_to "Mark Complete", complete_lab_path(lab), method: :patch, 
                      class: "px-3 py-1 text-xs font-medium text-white bg-green-600 rounded hover:bg-green-700" %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8">
          <p class="text-gray-500 mb-4">No labs added yet.</p>
          <%= link_to new_course_lab_path(@course), class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" do %>
            <i class="fas fa-plus mr-2"></i>
            Add Your First Lab
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
  
  <!-- Action Buttons -->
  <div class="mt-8 flex justify-between">
    <%= link_to "← Back to Courses", courses_path, 
        class: "inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50" %>
    
    <div class="space-x-3">
      <%= link_to notes_path(notable_type: 'Course', notable_id: @course.id), 
          class: "inline-flex items-center px-4 py-2 border border-indigo-300 text-sm font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50" do %>
        <i class="fas fa-sticky-note mr-2"></i>
        Notes (<%= @course.notes.count %>)
      <% end %>
      <%= link_to "Edit Course", edit_course_path(@course), 
          class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" %>
      <%= link_to "Delete Course", course_path(@course), method: :delete, 
          confirm: "Are you sure you want to delete this course?",
          class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700" %>
    </div>
  </div>
</div>

<script>
// Tab switching functionality
document.addEventListener('DOMContentLoaded', function() {
  const tabButtons = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      const targetTab = this.getAttribute('data-tab');
      
      // Remove active state from all buttons
      tabButtons.forEach(btn => {
        btn.classList.remove('border-blue-500', 'text-blue-600');
        btn.classList.add('border-transparent', 'text-gray-500');
      });
      
      // Add active state to clicked button
      this.classList.remove('border-transparent', 'text-gray-500');
      this.classList.add('border-blue-500', 'text-blue-600');
      
      // Hide all tab contents
      tabContents.forEach(content => {
        content.classList.add('hidden');
      });
      
      // Show target tab content
      document.getElementById(targetTab + '-tab').classList.remove('hidden');
    });
  });
});
</script>
